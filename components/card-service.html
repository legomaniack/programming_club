<link rel="import" 
  href="../bower_components/polymer/polymer.html">
<link rel="import" 
  href="../bower_components/core-ajax/core-ajax.html">
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-sha256.js"></script>

<polymer-element name="card-service" attributes="type cols colNum">
	<template>
		<style>
			:host {
				display: none;
			}
		</style>
		<core-ajax id="ajax"
			auto
			url="./php/getData.php?type={{type}}"
			on-core-response="{{cardsLoaded}}"
			handleAs="json">
		</core-ajax>
	</template>
	<script>
		Polymer({
			cards: [],
			colNum: 1,
			type: "projects",
			cols: [],
			ready: function () {
				this.calculateColumns();
			},
			colNumChanged: function() { //Recalculate columns on change
				this.calculateColumns(); 
			},
			cardsLoaded: function() {
				this.cards = this.$.ajax.response.slice(0);
				console.log(this.$.ajax.response.slice(0));
				this.calculateColumns();
			},
			calculateColumns : function() {
				cols = []
				for (var i=0; i < this.colNum; i++) {
					cols.push([]);
				}
				for (var i=0; i < this.cards.length; i++) {
					cols[i % this.colNum].push(this.cards[i]);
				}
				this.cols = cols;
			}
		});
	</script>
</polymer-element>